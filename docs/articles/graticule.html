<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Graticules for R • graticule</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">graticule</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mdsumner/graticule">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Graticules for R</h1>
                        <h4 class="author">Michael D. Sumner</h4>
            
            <h4 class="date">2017-01-08</h4>
          </div>

    
    
<div class="contents">
<!-- README.md is generated from README.Rmd. Please edit that file -->
<div id="graticule" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#graticule" class="anchor"> </a></body></html>Graticule</h1>
<p>Graticules are the longitude latitude lines shown on a projected map, and defining and drawing these lines is not easy to automate. The graticule package provides the tools to create and draw these lines by explicit specification by the user. This provides a good compromise between high-level automation and the flexibility to drive the low level details as needed, using base graphics in R.</p>
<p>Please note that this is an evolving topic, across a number of packages in R. There’s no ongoing integration of how best to do this, and some of the commentary in this vignette will be out of date quickly as individual packages do updates. I’ve recorded the exact versions used for this document at the end.</p>
<p>This is an area that needs much more discussion and outlining of needs and experiences.</p>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#examples" class="anchor"> </a></body></html>Examples</h1>
<p>A simple example uses data from rworldmap to build a map around the state of Victoria in Australia. Victoria uses a local Lambert Conformal Conic projection that was introduced while the shift to GDA94 was implemented, to reduce complications due to working with more than one UTM zone for the state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgdal)
<span class="kw">library</span>(raster)
<span class="kw">library</span>(rworldmap)
<span class="kw">data</span>(countriesLow)
llproj &lt;-<span class="st"> </span><span class="kw">projection</span>(countriesLow)
<span class="kw">library</span>(graticule)
map&lt;-<span class="st"> </span><span class="kw">subset</span>(countriesLow, SOVEREIGNT ==<span class="st"> "Australia"</span>)

## VicGrid
prj &lt;-<span class="st"> "+proj=lcc +lat_1=-36 +lat_2=-38 +lat_0=-37 +lon_0=145 +x_0=2500000 +y_0=2500000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs"</span>

pmap &lt;-<span class="st"> </span><span class="kw">spTransform</span>(map, <span class="kw">CRS</span>(prj))

## specify exactly where we want meridians and parallels
lons &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">140</span>, <span class="dv">150</span>, <span class="dt">length =</span> <span class="dv">5</span>)
lats &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">40</span>, -<span class="dv">35</span>, <span class="dt">length =</span> <span class="dv">6</span>)
## optionally, specify the extents of the meridians and parallels
## here we push them out a little on each side
xl &lt;-<span class="st">  </span><span class="kw">range</span>(lons) +<span class="st"> </span><span class="kw">c</span>(-<span class="fl">0.4</span>, <span class="fl">0.4</span>)
yl &lt;-<span class="st"> </span><span class="kw">range</span>(lats) +<span class="st"> </span><span class="kw">c</span>(-<span class="fl">0.4</span>, <span class="fl">0.4</span>)
## build the lines with our precise locations and ranges
grat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule.html">graticule</a></span>(lons, lats, <span class="dt">proj =</span> prj, <span class="dt">xlim =</span> xl, <span class="dt">ylim =</span> yl)
## build the labels, here they sit exactly on the western and northern extent
## of our line ranges
labs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule_labels.html">graticule_labels</a></span>(lons, lats, <span class="dt">xline =</span> <span class="kw">min</span>(xl), <span class="dt">yline =</span> <span class="kw">max</span>(yl), <span class="dt">proj =</span> prj)

## set up a map extent and plot
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))
<span class="kw">plot</span>(<span class="kw">extent</span>(grat) +<span class="st"> </span><span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>) *<span class="st"> </span><span class="fl">1e5</span>, <span class="dt">asp =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">"n"</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>)
<span class="kw">plot</span>(pmap, <span class="dt">add =</span> <span class="ot">TRUE</span>)
## the lines are a SpatialLinesDataFrame
<span class="kw">plot</span>(grat, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">5</span>, <span class="dt">col =</span> <span class="kw">rgb</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.8</span>))
## the labels are a SpatialPointsDataFrame, and islon tells us which kind
<span class="kw">text</span>(<span class="kw">subset</span>(labs, labs$islon), <span class="dt">lab =</span> <span class="kw">parse</span>(<span class="dt">text =</span> labs$lab[labs$islon]), <span class="dt">pos =</span> <span class="dv">3</span>)
<span class="kw">text</span>(<span class="kw">subset</span>(labs, !labs$islon), <span class="dt">lab =</span> <span class="kw">parse</span>(<span class="dt">text =</span> labs$lab[!labs$islon]), <span class="dt">pos =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="README-unnamed-chunk-2-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre></div>
<div id="a-polar-example" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#a-polar-example" class="anchor"> </a></body></html>A polar example</h2>
<p>Download some sea ice concentration data and plot with a graticule. These passive microwave data are defined on a Polar Stereographic grid on the Hughes ellipsoid (predating WGS84), and there are daily files available since 1978. This is not the prettiest map, but the example is showing how we have control over exactly where the lines are created. We can build the lines anywhere, not necessarily at regular intervals or rounded numbers, and we can over or under extend the parallels relative to the meridians and vice versa.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
<span class="kw">library</span>(graticule)
<span class="kw">library</span>(rgdal)
tfile &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"extdata"</span>,  <span class="st">"nt_20140320_f17_v01_s.bin"</span>, <span class="dt">package =</span> <span class="st">"graticule"</span>)
ice &lt;-<span class="st"> </span><span class="kw">raster</span>(tfile)

meridians &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">180</span>, <span class="dv">160</span>, <span class="dt">by =</span> <span class="dv">20</span>)
parallels &lt;-<span class="st"> </span><span class="kw">c</span>(-<span class="dv">80</span>, -<span class="fl">73.77</span>, -<span class="dv">68</span>, -<span class="dv">55</span>, -<span class="dv">45</span>)
mlim &lt;-<span class="st"> </span><span class="kw">c</span>(-<span class="dv">180</span>, <span class="dv">180</span>)
plim &lt;-<span class="st"> </span><span class="kw">c</span>(-<span class="dv">88</span>, -<span class="dv">50</span>)
grat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule.html">graticule</a></span>(<span class="dt">lons =</span> meridians, <span class="dt">lats =</span> parallels, <span class="dt">xlim =</span> mlim, <span class="dt">ylim =</span> plim, <span class="dt">proj =</span> <span class="kw">projection</span>(ice))
labs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule_labels.html">graticule_labels</a></span>(meridians, parallels, <span class="dt">xline =</span> -<span class="dv">45</span>, <span class="dt">yline =</span> -<span class="dv">60</span>, <span class="dt">proj =</span> <span class="kw">projection</span>(ice))
<span class="kw">plot</span>(ice, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
<span class="kw">plot</span>(grat, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">lty =</span> <span class="dv">3</span>)
<span class="kw">text</span>(labs, <span class="dt">lab =</span> <span class="kw">parse</span>(<span class="dt">text=</span> labs$lab), <span class="dt">col=</span> <span class="kw">c</span>(<span class="st">"firebrick"</span>, <span class="st">"darkblue"</span>)[labs$islon +<span class="st"> </span><span class="dv">1</span>], <span class="dt">cex =</span> <span class="fl">0.85</span>)
<span class="kw">title</span>(<span class="kw">sprintf</span>(<span class="st">"Sea ice concentration %s"</span>, <span class="kw">gsub</span>(<span class="st">".bin"</span>, <span class="st">""</span>, <span class="kw">basename</span>(tfile))), <span class="dt">cex.main =</span> <span class="fl">0.8</span>)
<span class="kw">title</span>(<span class="dt">sub =</span> <span class="kw">projection</span>(ice), <span class="dt">cex.sub =</span> <span class="fl">0.6</span>)</code></pre></div>
<p><img src="README-unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="create-the-graticule-as-polygons" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#create-the-graticule-as-polygons" class="anchor"> </a></body></html>Create the graticule as polygons</h2>
<p>Continuing from the sea ice example, build the graticule grid as actual polygons. Necessarily the <code>xlim/ylim</code> option is ignored since we have not specified sensibly closed polygonal rings where there are under or over laps.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">polargrid &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule.html">graticule</a></span>(<span class="dt">lons =</span> <span class="kw">c</span>(meridians, <span class="dv">180</span>), <span class="dt">lats =</span> parallels,  <span class="dt">proj =</span> <span class="kw">projection</span>(ice), <span class="dt">tiles =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; returning a SpatialPolygonsDataFrame but a future release with be sf</span>
centroids &lt;-<span class="st"> </span><span class="kw">project</span>(<span class="kw">coordinates</span>(polargrid), <span class="kw">projection</span>(ice), <span class="dt">inv =</span> <span class="ot">TRUE</span>)
labs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/graticule_labels.html">graticule_labels</a></span>(meridians, parallels,  <span class="dt">proj =</span> <span class="kw">projection</span>(ice))
<span class="co">#&gt; returning a SpatialPointsDataFrame but a future release will be sf</span>
<span class="co">#labs &lt;- graticule_labels(as.integer(centroids[,1]), as.integer(centroids[,2]),  proj = projection(ice))</span>
<span class="co">#labs &lt;- labs[!duplicated(as.data.frame(labs)), ] ## this needs a fix</span>
cols &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">colors</span>(), <span class="kw">nrow</span>(polargrid))
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))
<span class="kw">plot</span>(polargrid, <span class="dt">col  =</span> cols, <span class="dt">bg =</span> <span class="st">"black"</span>)
<span class="kw">text</span>(labs[labs$islon, ], <span class="dt">lab =</span> <span class="kw">parse</span>(<span class="dt">text =</span> labs$lab[labs$islon]), <span class="dt">col =</span> <span class="st">"white"</span>,  <span class="dt">cex =</span> <span class="fl">0.9</span>, <span class="dt">pos =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="README-unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre></div>
</div>
<div id="comparison-to-tools-in-sp-and-rgdal" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#comparison-to-tools-in-sp-and-rgdal" class="anchor"> </a></body></html>Comparison to tools in sp and rgdal</h2>
<p>The rgdal function <code>llgridlines()</code> will draw a graticule on a map but had a few limitations prior to May 2016 (some of this story is now out of date and has been improved).</p>
<ul>
<li>no control over the exact meridian and parallel lines to draw</li>
<li>the extent of lines is not independent of their perpendicular counterparts</li>
<li>relies on a projected object with sufficient verticular density.</li>
</ul>
<p>Many of these limitations can be worked around, especially by leveraging tools in the raster package but it’s not particularly elegant. Interestingly <code>mapGrid</code> in oce seems to share some of the same limitations, but I need to explore that more before being sure about the details.</p>
<p>Above we defined longitude and latitude ranges for an area of interest in Australia. We can plot the projected map and put on a <code>llgridlines</code> graticule. (Note that there’s a fair region around the main land mass of Australia here, due to Heard Island, Macquarie Island and Lord Howe Island driving the bounds of this map.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pmap)
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">NA</span>)
<span class="kw">llgridlines</span>(pmap)</code></pre></div>
<p><img src="README-unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre></div>
<p>We cannot easily modify the lines to be only in our local area, since <code>llgridlines</code> overrides our inputs with the bounding box of the overall object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(pmap)
lons &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">140</span>, <span class="dv">150</span>, <span class="dt">length =</span> <span class="dv">5</span>)
lats &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="dv">40</span>, -<span class="dv">35</span>, <span class="dt">length =</span> <span class="dv">6</span>)
<span class="kw">llgridlines</span>(pmap, <span class="dt">easts =</span> lons, <span class="dt">norths =</span> lats)</code></pre></div>
<p><img src="README-unnamed-chunk-6-1.png" width="672"></p>
<p>What we can do is crop the object, or create a new one with the overall extents of our region of interest. This is much closer to what I want but still I need to fiddle to get it just right.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">NA</span>)
ex &lt;-<span class="st"> </span><span class="kw">as</span>(<span class="kw">extent</span>(<span class="kw">range</span>(lons), <span class="kw">range</span>(lats)), <span class="st">"SpatialPolygons"</span>)
<span class="kw">projection</span>(ex) &lt;-<span class="st"> </span>llproj
pex &lt;-<span class="st"> </span><span class="kw">spTransform</span>(ex, <span class="kw">CRS</span>(<span class="kw">projection</span>(pmap)))
<span class="kw">plot</span>(<span class="kw">extent</span>(pex), <span class="dt">type =</span> <span class="st">"n"</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">""</span>, <span class="dt">ylab =</span> <span class="st">""</span>, <span class="dt">asp =</span> <span class="dv">1</span>)
<span class="kw">plot</span>(pmap, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">llgridlines</span>(pex, <span class="dt">easts =</span> lons, <span class="dt">norths =</span> lats)</code></pre></div>
<p><img src="README-unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre></div>
<p>How about the polar example? This is not bad, but the default number of vertices is not sufficient and we don’t get a sensible set of meridians.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ice, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
##llgridlines(ice)  does not understand a raster
<span class="kw">llgridlines</span>(<span class="kw">as</span>(ice, <span class="st">"SpatialPoints"</span>))</code></pre></div>
<p><img src="README-unnamed-chunk-8-1.png" width="672"></p>
<p>Try again, we increase the verticular density, but still I can’t get a line at -180/180 and 80S.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(ice, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
<span class="kw">llgridlines</span>(<span class="kw">as</span>(ice, <span class="st">"SpatialPoints"</span>), <span class="dt">easts =</span> <span class="kw">c</span>(-<span class="dv">180</span>, -<span class="dv">120</span>, -<span class="dv">60</span>, <span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">120</span>), <span class="dt">norths =</span> <span class="kw">c</span>(-<span class="dv">80</span>, -<span class="dv">70</span>, -<span class="dv">60</span>, -<span class="dv">50</span>), <span class="dt">ndiscr =</span> <span class="dv">50</span>)</code></pre></div>
<p><img src="README-unnamed-chunk-9-1.png" width="672"></p>
</div>
<div id="comparison-with-sf" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#comparison-with-sf" class="anchor"> </a></body></html>Comparison with sf</h2>
<p>(This is pretty good, needs more exploration.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
sf_map &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(pmap)
g &lt;-<span class="st"> </span><span class="kw">st_graticule</span>(sf_map)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(sf_map))
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">NA</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(g), <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">invisible</span>(<span class="kw">lapply</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(g)), function(i) {
if (g$type[i] ==<span class="st"> "N"</span> &amp;&amp;<span class="st"> </span>g$x_start[i] -<span class="st"> </span><span class="kw">min</span>(g$x_start) &lt;<span class="st"> </span><span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_start"</span>], g[i,<span class="st">"y_start"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_start[i], <span class="dt">pos =</span> <span class="dv">2</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "E"</span> &amp;&amp;<span class="st"> </span>g$y_start[i] -<span class="st"> </span><span class="kw">min</span>(g$y_start) &lt;<span class="st"> </span><span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_start"</span>], g[i,<span class="st">"y_start"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_start[i] -<span class="st"> </span><span class="dv">90</span>, <span class="dt">pos =</span> <span class="dv">1</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "N"</span> &amp;&amp;<span class="st"> </span>g$x_end[i] -<span class="st"> </span><span class="kw">max</span>(g$x_end) &gt;<span class="st"> </span>-<span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_end"</span>], g[i,<span class="st">"y_end"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_end[i], <span class="dt">pos =</span> <span class="dv">4</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "E"</span> &amp;&amp;<span class="st"> </span>g$y_end[i] -<span class="st"> </span><span class="kw">max</span>(g$y_end) &gt;<span class="st"> </span>-<span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_end"</span>], g[i,<span class="st">"y_end"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_end[i] -<span class="st"> </span><span class="dv">90</span>, <span class="dt">pos =</span> <span class="dv">3</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
}))</code></pre></div>
<p><img src="README-unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">par</span>(op)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw">library</span>(spex)
pex &lt;-<span class="st"> </span><span class="kw">spex</span>(ice)
<span class="kw">plot</span>(ice, <span class="dt">axes =</span> <span class="ot">FALSE</span>)
g &lt;-<span class="st"> </span><span class="kw">st_graticule</span>(<span class="kw">st_as_sf</span>(pex))
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(g), <span class="dt">add =</span> <span class="ot">TRUE</span>) 
op &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">xpd =</span> <span class="ot">NA</span>)
<span class="kw">invisible</span>(<span class="kw">lapply</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(g)), function(i) {
if (g$type[i] ==<span class="st"> "N"</span> &amp;&amp;<span class="st"> </span>g$x_start[i] -<span class="st"> </span><span class="kw">min</span>(g$x_start) &lt;<span class="st"> </span><span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_start"</span>], g[i,<span class="st">"y_start"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_start[i], <span class="dt">pos =</span> <span class="dv">2</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "E"</span> &amp;&amp;<span class="st"> </span>g$y_start[i] -<span class="st"> </span><span class="kw">min</span>(g$y_start) &lt;<span class="st"> </span><span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_start"</span>], g[i,<span class="st">"y_start"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_start[i] -<span class="st"> </span><span class="dv">90</span>, <span class="dt">pos =</span> <span class="dv">1</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "N"</span> &amp;&amp;<span class="st"> </span>g$x_end[i] -<span class="st"> </span><span class="kw">max</span>(g$x_end) &gt;<span class="st"> </span>-<span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_end"</span>], g[i,<span class="st">"y_end"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_end[i], <span class="dt">pos =</span> <span class="dv">4</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
if (g$type[i] ==<span class="st"> "E"</span> &amp;&amp;<span class="st"> </span>g$y_end[i] -<span class="st"> </span><span class="kw">max</span>(g$y_end) &gt;<span class="st"> </span>-<span class="dv">1000</span>)
    <span class="kw">text</span>(g[i,<span class="st">"x_end"</span>], g[i,<span class="st">"y_end"</span>], <span class="dt">labels =</span> <span class="kw">parse</span>(<span class="dt">text =</span> g[i,<span class="st">"degree_label"</span>]), 
        <span class="dt">srt =</span> g$angle_end[i] -<span class="st"> </span><span class="dv">90</span>, <span class="dt">pos =</span> <span class="dv">3</span>, <span class="dt">cex =</span> .<span class="dv">7</span>)
}))</code></pre></div>
<p><img src="README-unnamed-chunk-11-1.png" width="672"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">par</span>(op)</code></pre></div>
</div>
<div id="comparison-with-the-graticule-in-ggplot2" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#comparison-with-the-graticule-in-ggplot2" class="anchor"> </a></body></html>Comparison with the graticule in ggplot2</h2>
<p>TBD</p>
</div>
<div id="comparison-to-mapgrid-in-oce" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#comparison-to-mapgrid-in-oce" class="anchor"> </a></body></html>Comparison to <strong>mapGrid</strong> in oce</h2>
<p>The oce package has a lot of really neat map projection tools, but it works rather differently from the <em>Spatial</em> and <em>raster</em> tools in R. We need to drive the creation of the plot from the start with <code>mapPlot</code>, as it sets up the projection metadata for the current plot and handles that for subsequent plotting additions. (My use of oce is inexpert, I’m not across much of the details yet so I may well be off-track with some things here).</p>
<p>Here is our map of Victoria.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(oce)
## we need to hop the crevasse into another world

pp &lt;-<span class="st"> </span>raster::<span class="kw">geom</span>(map, <span class="dt">sepNA =</span> <span class="ot">TRUE</span>)
<span class="kw">mapPlot</span>(pp[,<span class="st">"x"</span>], pp[,<span class="st">"y"</span>], <span class="dt">projection =</span> <span class="kw">projection</span>(pmap), <span class="dt">longitudelim =</span> xl, <span class="dt">latitudelim =</span> yl, <span class="dt">type =</span> <span class="st">"p"</span>, <span class="dt">grid =</span> <span class="ot">FALSE</span>)
<span class="kw">mapGrid</span>(<span class="dt">longitude =</span> lons, <span class="dt">latitude =</span> lats)
## and to prove that all is well in the world
<span class="kw">plot</span>(pmap, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="st">"grey"</span>)
<span class="kw">mapGrid</span>(<span class="dt">longitude =</span> lons, <span class="dt">latitude =</span> lats)</code></pre></div>
<p><img src="README-unnamed-chunk-12-1.png" width="672"></p>
<p>Here is our polar map, this is good I haven’t explore oce enough yet to do it justice. For bonus points we add <code>mapTissot()</code>, which should be in the basic toolkit of all intrepid R mappers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ipts &lt;-<span class="st"> </span><span class="kw">coordinates</span>(<span class="kw">spTransform</span>(<span class="kw">xyFromCell</span>(ice, <span class="kw">sample</span>(<span class="kw">ncell</span>(ice), <span class="dv">1000</span>), <span class="dt">spatial =</span> <span class="ot">TRUE</span>), <span class="kw">CRS</span>(llproj)))
<span class="kw">mapPlot</span>(ipts[,<span class="dv">1</span>], ipts[,<span class="dv">2</span>], <span class="dt">projection =</span> <span class="kw">projection</span>(ice), <span class="dt">type =</span> <span class="st">"n"</span>, <span class="dt">grid =</span> <span class="ot">FALSE</span>)

<span class="kw">plot</span>(ice, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">mapGrid</span>(<span class="dv">10</span>, <span class="dv">15</span>)
<span class="kw">mapTissot</span>()</code></pre></div>
<p><img src="README-unnamed-chunk-13-1.png" width="672"></p>
<p>Also see here for another implementation of the Tissot Indicatrix in R by user <a href="http://gis.stackexchange.com/questions/31651/an-example-tissot-ellipse-for-an-equirectangular-projection">whuber on GIS StackExchange</a>. This is available in the <a href="https://github.com/mdsumner/tissot">dev package tissot</a>.</p>
</div>
<div id="notes" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#notes" class="anchor"> </a></body></html>Notes</h2>
<p>Efforts could be shared with the sp and rgdal projects to improve the functionality for the <code>llgridlines</code> and its worker functions <code>gridlines</code> and <code>gridat</code> in that central place, and I agree with this. But I have an interest in working with graticules more directly as objects, and potentially stored in relational-table approach built on dplyr, and so I just found it simpler to start from scratch in this package. Also, there is a lot of this functionality spread around the place in sp, raster, maptools, fields, oce and many others. It is time for a new review, analogous to the effort that built sp in ca. 2002.</p>
<div id="terminology" class="section level3">
<h3 class="hasAnchor">
<html><body><a href="#terminology" class="anchor"> </a></body></html>Terminology</h3>
<p>I tend to use the same terminology as used within <a href="http://www.manifold.net/">Manifold System</a> <em>because it’s so awesome</em> and that’s where I first learnt about most of these concepts. In my experience not many people use the term <em>graticule</em> in this way, so take it from the master himself on page 8 (Snyder, 1987):</p>
<blockquote>
<p>To identify the location of points on the Earth, a graticule or network of longitude and latitude lines has been superimposed on the surface. They are commonly referred to as meridians and parallels, respectively.</p>
</blockquote>
<p>“Verticular density” is kind of a joke, but I like it. YMMV</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#references" class="anchor"> </a></body></html>References</h2>
<p><a href="http://pubs.er.usgs.gov/djvu/PP/PP_1395.pdf">Snyder, John Parr. Map projections–A working manual. No. 1395. USGPO, 1987.</a></p>
</div>
<div id="environment" class="section level2">
<h2 class="hasAnchor">
<html><body><a href="#environment" class="anchor"> </a></body></html>Environment</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">session_info</span>()
<span class="co">#&gt; Session info -------------------------------------------------------------</span>
<span class="co">#&gt;  setting  value                                      </span>
<span class="co">#&gt;  version  R version 3.3.2 Patched (2016-11-09 r71647)</span>
<span class="co">#&gt;  system   x86_64, mingw32                            </span>
<span class="co">#&gt;  ui       RStudio (1.0.136)                          </span>
<span class="co">#&gt;  language (EN)                                       </span>
<span class="co">#&gt;  collate  English_Australia.1252                     </span>
<span class="co">#&gt;  tz       Australia/Hobart                           </span>
<span class="co">#&gt;  date     2017-01-08</span>
<span class="co">#&gt; Packages -----------------------------------------------------------------</span>
<span class="co">#&gt;  package    * version     date       source                            </span>
<span class="co">#&gt;  assertthat   0.1         2013-12-06 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  backports    1.0.4       2016-10-24 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  crayon       1.3.2       2016-06-28 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  DBI          0.5-1       2016-09-10 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  desc         1.0.1       2016-09-23 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  devtools     1.12.0.9000 2016-12-28 Github (hadley/devtools@1ce84b0)  </span>
<span class="co">#&gt;  digest       0.6.11      2017-01-03 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  dplyr        0.5.0       2016-06-24 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  evaluate     0.10        2016-10-11 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  fields       8.10        2016-12-16 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  foreign      0.8-67      2016-09-13 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  graticule  * 0.1.5       &lt;NA&gt;       local                             </span>
<span class="co">#&gt;  gsw        * 1.0-3       2015-01-19 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  highlight    0.4.7       2015-04-20 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  htmltools    0.3.5       2016-03-21 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  knitr        1.15.1      2016-11-22 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  lattice      0.20-34     2016-09-06 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  lazyeval     0.2.0       2016-06-12 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  magrittr     1.5         2014-11-22 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  maps         3.1.1       2016-07-27 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  maptools     0.8-40      2016-11-15 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  memoise      1.0.0       2016-01-29 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  oce        * 0.9-20      2016-11-19 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  pkgbuild     0.0.0.9000  2016-11-22 Github (r-pkgs/pkgbuild@65eace0)  </span>
<span class="co">#&gt;  pkgdown      0.1.0.9000  2017-01-06 Github (hadley/pkgdown@f23ddb0)   </span>
<span class="co">#&gt;  pkgload      0.0.0.9000  2016-11-13 Github (r-pkgs/pkgload@def2b10)   </span>
<span class="co">#&gt;  purrr        0.2.2       2016-06-18 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  quadmesh     0.1.0       2016-06-12 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  R6           2.2.0       2016-10-05 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  raster     * 2.5-8       2016-06-02 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  Rcpp         0.12.8.4    2017-01-08 Github (RcppCore/Rcpp@8ac38d7)    </span>
<span class="co">#&gt;  rgdal      * 1.2-5       2016-12-15 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  rmarkdown    1.3         2017-01-06 Github (rstudio/rmarkdown@3544f1d)</span>
<span class="co">#&gt;  roxygen2     5.0.1       2015-11-11 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  rprojroot    1.1         2016-10-29 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  rsconnect    0.7         2016-12-21 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  rstudioapi   0.6         2016-06-27 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  rworldmap  * 1.3-6       2016-02-03 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  sf         * 0.2-9       2017-01-08 Github (edzer/sfr@d87fdc2)        </span>
<span class="co">#&gt;  sp         * 1.2-4       2016-12-22 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  spam         1.4-0       2016-08-30 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  spex       * 0.2.0       2016-12-28 Github (mdsumner/spex@6ceb880)    </span>
<span class="co">#&gt;  stringi      1.1.2       2016-10-01 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  stringr      1.1.0       2016-08-19 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  testthat     1.0.2       2016-04-23 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  tibble       1.2         2016-08-26 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  udunits2     0.13        2016-11-17 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  units        0.4-1       2016-12-09 CRAN (R 3.3.2)                    </span>
<span class="co">#&gt;  whisker      0.3-2       2013-04-28 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  withr        1.0.2       2016-06-20 CRAN (R 3.3.1)                    </span>
<span class="co">#&gt;  xml2         1.1.0       2017-01-06 Github (hadley/xml2@42544d6)      </span>
<span class="co">#&gt;  yaml         2.1.14      2016-11-12 CRAN (R 3.3.2)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#graticule">Graticule</a></li>
      <li>
<a href="#examples">Examples</a><ul class="nav nav-pills nav-stacked">
<li><a href="#a-polar-example">A polar example</a></li>
      <li><a href="#create-the-graticule-as-polygons">Create the graticule as polygons</a></li>
      <li><a href="#comparison-to-tools-in-sp-and-rgdal">Comparison to tools in sp and rgdal</a></li>
      <li><a href="#comparison-with-sf">Comparison with sf</a></li>
      <li><a href="#comparison-with-the-graticule-in-ggplot2">Comparison with the graticule in ggplot2</a></li>
      <li><a href="#comparison-to-mapgrid-in-oce">Comparison to <strong>mapGrid</strong> in oce</a></li>
      <li><a href="#notes">Notes</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#environment">Environment</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Michael D. Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
